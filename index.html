<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Static Calculation Reviewer</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<style>
  :root { --gap:12px; --radius:10px; --max:920px; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,sans-serif;}
  body { margin:0; background:#0b0d12; color:#e8eaf1; display:grid; place-items:start center; padding:32px;}
  .card { width:min(100%,var(--max)); background:#141926; border:1px solid #2a3246; border-radius:var(--radius); padding:24px; box-shadow:0 10px 30px rgba(0,0,0,.35);}
  h1 { margin:0 0 10px; font-size:22px;}
  label { display:block; margin:16px 0 6px; color:#aab2c8;}
  textarea, select { width:100%; box-sizing:border-box; background:#0f1420; color:#e8eaf1; border:1px solid #2a3246; border-radius:8px; padding:10px 12px;}
  textarea { min-height:140px; resize:vertical;}
  .row { display:grid; grid-template-columns:1fr 1fr; gap:var(--gap);}
  .btn { appearance:none; border:0; padding:12px 16px; border-radius:8px; cursor:pointer; font-weight:600;}
  .primary { background:#4e7cff; color:white;} .muted{background:#20283a; color:#c7cfe2;}
  .stack { display:grid; gap:var(--gap);} .status{ margin-top:10px; color:#aab2c8;}
  .pill{ padding:2px 8px; border-radius:999px; font-size:12px; display:inline-block; margin-right:6px; border:1px solid #2a3246;}
  .ok{background:#15361a;color:#7ee084;border-color:#214a29;}
  .warning{background:#3b2e12;color:#ffd370;border-color:#55401a;}
  .error{background:#3a1720;color:#ff8095;border-color:#53202c;}
  .section{ border-top:1px dashed #2a3246; padding-top:16px; margin-top:16px;}
  pre{ background:#0f1420; padding:12px; border-radius:8px; overflow:auto;}
  .checks{ display:grid; gap:8px;}
</style>
</head>
<body>
  <div class="card stack">
    <h1>ðŸ§® Static Calculation Reviewer</h1>
    <div class="row">
      <div class="stack">
        <label for="standard">Preferred standard</label>
        <select id="standard">
          <option>unspecified</option>
          <option>TS500</option>
          <option>Eurocode 3</option>
          <option>AISC 360</option>
          <option>EN 1992-1-1</option>
        </select>
      </div>
      <div class="stack">
        <label for="worker">Your Worker URL</label>
        <input id="worker" placeholder="https://your-subdomain.workers.dev" />
      </div>
    </div>

    <label for="problem">Problem</label>
    <textarea id="problem" placeholder="Beam L=6 m, w=5+3 kN/m, IPE270 S275, check strength & deflection per EC3."></textarea>

    <label for="code">Optional equations / calc steps / code</label>
    <textarea id="code" placeholder="(Optional)"></textarea>

    <div class="row">
      <button class="btn primary" id="submit">Review</button>
      <button class="btn muted" id="sample">Load sample</button>
    </div>
    <div id="status" class="status"></div>

    <div id="out" class="section" hidden>
      <h3 id="title"></h3>
      <p id="summary"></p>

      <div class="section">
        <h4>Assumptions</h4>
        <ul id="assumptions"></ul>
      </div>

      <div class="section">
        <h4>Checklist</h4>
        <div id="checks" class="checks"></div>
      </div>

      <div class="section" id="issuesWrap" hidden>
        <h4>Issues</h4>
        <ul id="issues"></ul>
      </div>

      <div class="section" id="recsWrap" hidden>
        <h4>Recommendations</h4>
        <ul id="recs"></ul>
      </div>

      <div class="section">
        <h4>Full report (Markdown)</h4>
        <div id="md"></div>
      </div>

      <div class="section">
        <small id="disc"></small>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const $ = (id) => document.getElementById(id);
    $("sample").onclick = () => {
      $("problem").value = "Simply supported steel beam, L=6.0 m. Dead=5 kN/m, Live=3 kN/m. IPE270 S275. Check strength & deflection.";
      $("standard").value = "Eurocode 3";
    };

    $("submit").onclick = async () => {
      const url = $("worker").value.trim(); // your Worker endpoint
      const body = {
        problem_text: $("problem").value,
        code_block: $("code").value,
        standard: $("standard").value
      };

      $("status").textContent = "Analyzingâ€¦";
      $("out").hidden = true;

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error("Server error: " + res.status);
        const data = await res.json();

        $("title").textContent = data.title || "";
        $("summary").textContent = data.summary || "";

        $("assumptions").innerHTML = (data.assumptions || []).map(a => `<li>${a}</li>`).join("");
        $("checks").innerHTML = (data.checks || []).map(c =>
          `<div class="pill ${c.status}">${c.status}</div> <strong>${c.name}</strong> â€” ${c.detail}`
        ).join("<br>");

        if (data.issues?.length) {
          $("issuesWrap").hidden = false;
          $("issues").innerHTML = data.issues.map(i => `<li>${i}</li>`).join("");
        } else { $("issuesWrap").hidden = true; }

        if (data.recommendations?.length) {
          $("recsWrap").hidden = false;
          $("recs").innerHTML = data.recommendations.map(r => `<li>${r}</li>`).join("");
        } else { $("recsWrap").hidden = true; }

        $("md").innerHTML = window.marked ? marked.parse(data.formatted_markdown || "") :
                           `<pre>${data.formatted_markdown || ""}</pre>`;
        $("disc").textContent = data.disclaimer || "";

        $("status").textContent = "Done.";
        $("out").hidden = false;
      } catch (e) {
        $("status").textContent = e.message;
      }
    };
  </script>
</body>
</html>
